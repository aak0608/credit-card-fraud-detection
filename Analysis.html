<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Credit card fraud detection</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="Analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="Analysis_files/libs/quarto-html/quarto.js"></script>
<script src="Analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="Analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="Analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Analysis_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Analysis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="Analysis_files/libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>

<link href="Analysis_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">

<script src="Analysis_files/libs/datatables-binding-0.28/datatables.js"></script>

<script src="Analysis_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="Analysis_files/libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">

<link href="Analysis_files/libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">

<script src="Analysis_files/libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script>

<link href="Analysis_files/libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="Analysis_files/libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<script src="Analysis_files/libs/kePrint-0.0.1/kePrint.js"></script>

<link href="Analysis_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">



</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Credit card fraud detection</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Credit card fraud is a growing concern in the financial industry, causing significant losses for banks and customers alike. With the rise of online transactions and digital payments, fraudsters have become increasingly sophisticated in exploiting security vulnerabilities. Detecting fraudulent transactions is a challenging task due to the highly imbalanced nature of fraud datasets, where fraudulent transactions represent only a small fraction of total transactions.</p>
<p>The dataset used in this analysis is derived from real-world credit card transactions and contains anonymized features extracted using Principal Component Analysis (PCA). The goal is to build predictive models that can accurately distinguish between fraudulent and legitimate transactions, helping financial institutions prevent financial losses and enhance security measures.</p>
</section>
<section id="reading-the-data" class="level1">
<h1>Reading the data</h1>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-20f907aa41ca84641a3b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-20f907aa41ca84641a3b">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6"],[0,0,1,1,2,2],[-1.3598071336738,1.19185711131486,-1.35835406159823,-0.966271711572087,-1.15823309349523,-0.425965884412454],[-0.07278117330984971,0.26615071205963,-1.34016307473609,-0.185226008082898,0.877736754848451,0.960523044882985],[2.53634673796914,0.16648011335321,1.77320934263119,1.79299333957872,1.548717846511,1.14110934232219],[1.37815522427443,0.448154078460911,0.379779593034328,-0.863291275036453,0.403033933955121,-0.168252079760302],[-0.338320769942518,0.0600176492822243,-0.503198133318193,-0.0103088796030823,-0.407193377311653,0.42098688077219],[0.462387777762292,-0.0823608088155687,1.80049938079263,1.24720316752486,0.0959214624684256,-0.0297275516639742],[0.239598554061257,-0.0788029833323113,0.791460956450422,0.23760893977178,0.592940745385545,0.476200948720027],[0.0986979012610507,0.08510165491481041,0.247675786588991,0.377435874652262,-0.270532677192282,0.260314333074874],[0.363786969611213,-0.255425128109186,-1.51465432260583,-1.38702406270197,0.8177393082352939,-0.56867137571251],[0.0907941719789316,-0.166974414004614,0.207642865216696,-0.0549519224713749,0.753074431976354,-0.371407196834471],[-0.551599533260813,1.61272666105479,0.624501459424895,-0.226487263835401,-0.822842877946363,1.34126198001957],[-0.617800855762348,1.06523531137287,0.066083685268831,0.178228225877303,0.53819555014995,0.359893837038039],[-0.991389847235408,0.48909501589608,0.7172927314108311,0.507756869957169,1.3458515932154,-0.358090652573631],[-0.311169353699879,-0.143772296441519,-0.165945922763554,-0.28792374549456,-1.11966983471731,-0.137133700217612],[1.46817697209427,0.635558093258208,2.34586494901581,-0.631418117709045,0.175121130008994,0.517616806555742],[-0.470400525259478,0.463917041022171,-2.89008319444231,-1.0596472454325,-0.451449182813529,0.401725895589603],[0.207971241929242,-0.114804663102346,1.10996937869599,-0.684092786345479,-0.237033239362776,-0.0581328233640131],[0.0257905801985591,-0.183361270123994,-0.121359313195888,1.96577500349538,-0.0381947870352842,0.06865314944254319],[0.403992960255733,-0.145783041325259,-2.26185709530414,-1.2326219700892,0.803486924960175,-0.0331937877876282],[0.251412098239705,-0.0690831352230203,0.5249797252244039,-0.208037781160366,0.408542360392758,0.08496767206820489],[-0.018306777944153,-0.225775248033138,0.247998153469754,-0.108300452035545,-0.009430697132329189,-0.208253514656728],[0.277837575558899,-0.638671952771851,0.7716794019172289,0.00527359678253453,0.79827849458971,-0.559824796253248],[-0.110473910188767,0.101288021253234,0.909412262347719,-0.190320518742841,-0.137458079619063,-0.0263976679795373],[0.06692807491467311,-0.339846475529127,-0.689280956490685,-1.17557533186321,0.141266983824769,-0.371426583174346],[0.128539358273528,0.167170404418143,-0.327641833735251,0.647376034602038,-0.206009587619756,-0.232793816737034],[-0.189114843888824,0.125894532368176,-0.139096571514147,-0.221928844458407,0.502292224181569,0.105914779097957],[0.133558376740387,-0.00898309914322813,-0.0553527940384261,0.0627228487293033,0.219422229513348,0.253844224739337],[-0.0210530534538215,0.0147241691924927,-0.0597518405929204,0.0614576285006353,0.215153147499206,0.08108025692294429],[149.62,2.69,378.66,123.5,69.98999999999999,3.67],[0,0,0,0,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Time<\/th>\n      <th>V1<\/th>\n      <th>V2<\/th>\n      <th>V3<\/th>\n      <th>V4<\/th>\n      <th>V5<\/th>\n      <th>V6<\/th>\n      <th>V7<\/th>\n      <th>V8<\/th>\n      <th>V9<\/th>\n      <th>V10<\/th>\n      <th>V11<\/th>\n      <th>V12<\/th>\n      <th>V13<\/th>\n      <th>V14<\/th>\n      <th>V15<\/th>\n      <th>V16<\/th>\n      <th>V17<\/th>\n      <th>V18<\/th>\n      <th>V19<\/th>\n      <th>V20<\/th>\n      <th>V21<\/th>\n      <th>V22<\/th>\n      <th>V23<\/th>\n      <th>V24<\/th>\n      <th>V25<\/th>\n      <th>V26<\/th>\n      <th>V27<\/th>\n      <th>V28<\/th>\n      <th>Amount<\/th>\n      <th>Class<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="about-the-data" class="level1">
<h1>About the data</h1>
<section id="columns-in-the-credit-card-fraud-detection-dataset" class="level2">
<h2 class="anchored" data-anchor-id="columns-in-the-credit-card-fraud-detection-dataset">Columns in the Credit Card Fraud Detection Dataset</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Column Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Time</td>
<td>Seconds elapsed between this transaction and the first transaction in the dataset.</td>
</tr>
<tr class="even">
<td>V1 to V28</td>
<td>Anonymized features resulting from a PCA transformation.</td>
</tr>
<tr class="odd">
<td>Amount</td>
<td>The transaction amount.</td>
</tr>
<tr class="even">
<td>Class</td>
<td>Target variable (0 for legitimate transactions, 1 for fraudulent transactions).</td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The data has the dimensions of 284807, 31.</p>
<section id="dataset-and-its-significance" class="level3">
<h3 class="anchored" data-anchor-id="dataset-and-its-significance">Dataset and Its Significance</h3>
<p>The dataset used in this analysis consists of anonymized credit card transactions, where each row represents a single transaction. Due to privacy concerns, the dataset does not include personally identifiable information but instead provides 28 principal components (V1 to V28) obtained using PCA. The dataset also includes the transaction amount and a binary label (<code>Class</code>), where: - <code>0</code> represents a legitimate (non-fraudulent) transaction. - <code>1</code> represents a fraudulent transaction.</p>
<p>Detecting fraudulent transactions is particularly challenging because fraud cases are rare. The class imbalance means that naive models may predict most transactions as non-fraudulent and still achieve high accuracy, making it essential to use alternative evaluation metrics such as precision, recall, and the F1-score.</p>
<p>By exploring this dataset, we aim to uncover key patterns that distinguish fraudulent transactions from legitimate ones, aiding in the development of more robust fraud detection systems. Fraudulent transactions often exhibit distinct characteristics, such as unusual spending behavior, high transaction amounts, or rapid consecutive transactions from different locations. Understanding these patterns allows financial institutions to implement real-time fraud detection systems that minimize false positives while effectively identifying fraudulent activities.</p>
<p>Additionally, credit card fraud detection relies heavily on machine learning algorithms due to the vast amount of transaction data generated every second. By leveraging supervised learning models and data preprocessing techniques such as PCA transformation and oversampling methods, we can enhance the detection of fraudulent activities. The findings from this study can help improve financial security measures and refine existing fraud detection systems by identifying high-risk transactions efficiently.</p>
</section>
</div>
</div>
</section>
<section id="exploring-the-data" class="level2">
<h2 class="anchored" data-anchor-id="exploring-the-data">Exploring the data</h2>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-f3156266aaafa59a753a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f3156266aaafa59a753a">{"x":{"filter":"none","vertical":false,"data":[["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["     Time","     Time","     Time","     Time","     Time","     Time","      V1","      V1","      V1","      V1","      V1","      V1","      V2","      V2","      V2","      V2","      V2","      V2","      V3","      V3","      V3","      V3","      V3","      V3","      V4","      V4","      V4","      V4","      V4","      V4","      V5","      V5","      V5","      V5","      V5","      V5","      V6","      V6","      V6","      V6","      V6","      V6","      V7","      V7","      V7","      V7","      V7","      V7","      V8","      V8","      V8","      V8","      V8","      V8","      V9","      V9","      V9","      V9","      V9","      V9","     V10","     V10","     V10","     V10","     V10","     V10","     V11","     V11","     V11","     V11","     V11","     V11","     V12","     V12","     V12","     V12","     V12","     V12","     V13","     V13","     V13","     V13","     V13","     V13","     V14","     V14","     V14","     V14","     V14","     V14","     V15","     V15","     V15","     V15","     V15","     V15","     V16","     V16","     V16","     V16","     V16","     V16","     V17","     V17","     V17","     V17","     V17","     V17","     V18","     V18","     V18","     V18","     V18","     V18","     V19","     V19","     V19","     V19","     V19","     V19","     V20","     V20","     V20","     V20","     V20","     V20","     V21","     V21","     V21","     V21","     V21","     V21","     V22","     V22","     V22","     V22","     V22","     V22","     V23","     V23","     V23","     V23","     V23","     V23","     V24","     V24","     V24","     V24","     V24","     V24","     V25","     V25","     V25","     V25","     V25","     V25","     V26","     V26","     V26","     V26","     V26","     V26","     V27","     V27","     V27","     V27","     V27","     V27","     V28","     V28","     V28","     V28","     V28","     V28","    Amount","    Amount","    Amount","    Amount","    Amount","    Amount","    Class","    Class","    Class","    Class","    Class","    Class"],["Min.   :     0  ","1st Qu.: 54202  ","Median : 84692  ","Mean   : 94814  ","3rd Qu.:139321  ","Max.   :172792  ","Min.   :-56.40751  ","1st Qu.: -0.92037  ","Median :  0.01811  ","Mean   :  0.00000  ","3rd Qu.:  1.31564  ","Max.   :  2.45493  ","Min.   :-72.71573  ","1st Qu.: -0.59855  ","Median :  0.06549  ","Mean   :  0.00000  ","3rd Qu.:  0.80372  ","Max.   : 22.05773  ","Min.   :-48.3256  ","1st Qu.: -0.8904  ","Median :  0.1799  ","Mean   :  0.0000  ","3rd Qu.:  1.0272  ","Max.   :  9.3826  ","Min.   :-5.68317  ","1st Qu.:-0.84864  ","Median :-0.01985  ","Mean   : 0.00000  ","3rd Qu.: 0.74334  ","Max.   :16.87534  ","Min.   :-113.74331  ","1st Qu.:  -0.69160  ","Median :  -0.05434  ","Mean   :   0.00000  ","3rd Qu.:   0.61193  ","Max.   :  34.80167  ","Min.   :-26.1605  ","1st Qu.: -0.7683  ","Median : -0.2742  ","Mean   :  0.0000  ","3rd Qu.:  0.3986  ","Max.   : 73.3016  ","Min.   :-43.5572  ","1st Qu.: -0.5541  ","Median :  0.0401  ","Mean   :  0.0000  ","3rd Qu.:  0.5704  ","Max.   :120.5895  ","Min.   :-73.21672  ","1st Qu.: -0.20863  ","Median :  0.02236  ","Mean   :  0.00000  ","3rd Qu.:  0.32735  ","Max.   : 20.00721  ","Min.   :-13.43407  ","1st Qu.: -0.64310  ","Median : -0.05143  ","Mean   :  0.00000  ","3rd Qu.:  0.59714  ","Max.   : 15.59500  ","Min.   :-24.58826  ","1st Qu.: -0.53543  ","Median : -0.09292  ","Mean   :  0.00000  ","3rd Qu.:  0.45392  ","Max.   : 23.74514  ","Min.   :-4.79747  ","1st Qu.:-0.76249  ","Median :-0.03276  ","Mean   : 0.00000  ","3rd Qu.: 0.73959  ","Max.   :12.01891  ","Min.   :-18.6837  ","1st Qu.: -0.4056  ","Median :  0.1400  ","Mean   :  0.0000  ","3rd Qu.:  0.6182  ","Max.   :  7.8484  ","Min.   :-5.79188  ","1st Qu.:-0.64854  ","Median :-0.01357  ","Mean   : 0.00000  ","3rd Qu.: 0.66251  ","Max.   : 7.12688  ","Min.   :-19.2143  ","1st Qu.: -0.4256  ","Median :  0.0506  ","Mean   :  0.0000  ","3rd Qu.:  0.4931  ","Max.   : 10.5268  ","Min.   :-4.49894  ","1st Qu.:-0.58288  ","Median : 0.04807  ","Mean   : 0.00000  ","3rd Qu.: 0.64882  ","Max.   : 8.87774  ","Min.   :-14.12985  ","1st Qu.: -0.46804  ","Median :  0.06641  ","Mean   :  0.00000  ","3rd Qu.:  0.52330  ","Max.   : 17.31511  ","Min.   :-25.16280  ","1st Qu.: -0.48375  ","Median : -0.06568  ","Mean   :  0.00000  ","3rd Qu.:  0.39968  ","Max.   :  9.25353  ","Min.   :-9.498746  ","1st Qu.:-0.498850  ","Median :-0.003636  ","Mean   : 0.000000  ","3rd Qu.: 0.500807  ","Max.   : 5.041069  ","Min.   :-7.213527  ","1st Qu.:-0.456299  ","Median : 0.003735  ","Mean   : 0.000000  ","3rd Qu.: 0.458949  ","Max.   : 5.591971  ","Min.   :-54.49772  ","1st Qu.: -0.21172  ","Median : -0.06248  ","Mean   :  0.00000  ","3rd Qu.:  0.13304  ","Max.   : 39.42090  ","Min.   :-34.83038  ","1st Qu.: -0.22839  ","Median : -0.02945  ","Mean   :  0.00000  ","3rd Qu.:  0.18638  ","Max.   : 27.20284  ","Min.   :-10.933144  ","1st Qu.: -0.542350  ","Median :  0.006782  ","Mean   :  0.000000  ","3rd Qu.:  0.528554  ","Max.   : 10.503090  ","Min.   :-44.80774  ","1st Qu.: -0.16185  ","Median : -0.01119  ","Mean   :  0.00000  ","3rd Qu.:  0.14764  ","Max.   : 22.52841  ","Min.   :-2.83663  ","1st Qu.:-0.35459  ","Median : 0.04098  ","Mean   : 0.00000  ","3rd Qu.: 0.43953  ","Max.   : 4.58455  ","Min.   :-10.29540  ","1st Qu.: -0.31715  ","Median :  0.01659  ","Mean   :  0.00000  ","3rd Qu.:  0.35072  ","Max.   :  7.51959  ","Min.   :-2.60455  ","1st Qu.:-0.32698  ","Median :-0.05214  ","Mean   : 0.00000  ","3rd Qu.: 0.24095  ","Max.   : 3.51735  ","Min.   :-22.565679  ","1st Qu.: -0.070840  ","Median :  0.001342  ","Mean   :  0.000000  ","3rd Qu.:  0.091045  ","Max.   : 31.612198  ","Min.   :-15.43008  ","1st Qu.: -0.05296  ","Median :  0.01124  ","Mean   :  0.00000  ","3rd Qu.:  0.07828  ","Max.   : 33.84781  ","Min.   :    0.00  ","1st Qu.:    5.60  ","Median :   22.00  ","Mean   :   88.35  ","3rd Qu.:   77.17  ","Max.   :25691.16  ","Min.   :0.000000  ","1st Qu.:0.000000  ","Median :0.000000  ","Mean   :0.001728  ","3rd Qu.:0.000000  ","Max.   :1.000000  "]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Var1<\/th>\n      <th>Var2<\/th>\n      <th>Freq<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<section id="check-class-imbalance" class="level3">
<h3 class="anchored" data-anchor-id="check-class-imbalance">Check Class Imbalance</h3>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold; color: white !important; background-color: lightblue !important;">Var1</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: lightblue !important;">Freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; border-right: 1px solid;">0</td>
<td style="text-align: right;">284315</td>
</tr>
<tr class="even">
<td style="text-align: left; border-right: 1px solid;">1</td>
<td style="text-align: right;">492</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="visualizing-class-distribution" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-class-distribution">Visualizing Class Distribution</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Analysis_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Observation for Class Distribution Graph</strong></p>
<p>The bar graph visually represents the distribution of fraudulent and non-fraudulent transactions in the dataset.</p>
<ul>
<li>Severe Class Imbalance:</li>
</ul>
<ol type="1">
<li><p>The graph shows that the vast majority of transactions belong to the non-fraudulent class (0), while fraudulent transactions (1) make up a tiny fraction of the dataset.</p></li>
<li><p>This extreme imbalance is a common challenge in fraud detection, as models may become biased toward predicting the majority class, leading to poor recall for fraud cases.</p></li>
</ol>
<ul>
<li>Impact on Model Performance:</li>
</ul>
<ol type="1">
<li><p>Since fraud transactions are rare, a naïve model that predicts all transactions as non-fraudulent would still achieve high accuracy.</p></li>
<li><p>However, accuracy alone is misleading in this scenario, as the model would fail to correctly identify fraud cases, which is the primary objective of fraud detection.</p></li>
</ol>
<ul>
<li>Need for Resampling Techniques:</li>
</ul>
<p>Due to this imbalance, techniques such as oversampling, undersampling, or synthetic data generation (e.g., SMOTE or ROSE) are necessary to balance the dataset and improve model learning.</p>
</div>
</div>
</section>
<section id="pca-scatter-plot" class="level3">
<h3 class="anchored" data-anchor-id="pca-scatter-plot">PCA Scatter Plot</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Analysis_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>Fraudulent transactions (Class 1) are concentrated in distinct regions of the PCA-transformed space.</p></li>
<li><p>Non-fraudulent transactions (Class 0) are more dispersed, indicating greater variation in their feature distribution.</p></li>
<li><p>The clustering of fraudulent transactions suggests that certain PCA components can be useful in fraud detection.</p></li>
</ol>
</div>
</div>
</section>
<section id="density-plot-for-amount" class="level3">
<h3 class="anchored" data-anchor-id="density-plot-for-amount">Density Plot for Amount</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Analysis_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Analysis_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Based on the density plots, some of the interesting observations are:</p>
<p><strong>Fraudulent Transactions Show Distinct Density Distributions</strong></p>
<p>Fraudulent transactions (Class 1) exhibit different density peaks compared to legitimate transactions (Class 0). The density for fraud cases is generally lower, but it is concentrated in specific transaction amount ranges.</p>
<p><strong>Fraud Occurrence Increases with Higher Transaction Amounts</strong></p>
<p>As we move to the “High” and “Very High” transaction amount categories, fraudulent transactions appear more frequently.This suggests that fraudsters often target higher-value transactions, possibly to maximize their financial gain.</p>
<p><strong>Legitimate Transactions Are More Evenly Distributed</strong></p>
<p>The density of legitimate transactions remains relatively high across all amount categories, indicating that customers make a wide range of purchases. Unlike fraudulent transactions, they do not exhibit sharp density spikes in specific ranges.</p>
<p><strong>Overlapping Distributions in Lower Amount Categories</strong></p>
<p>In the “Low” and “Medium” amount bins, there is significant overlap between fraudulent and legitimate transactions, making fraud detection more challenging in this range. This suggests that lower-value fraudulent transactions may be harder to differentiate from normal purchases.</p>
<p><strong>Potential for Threshold-Based Fraud Detection</strong></p>
<p>Given the differences in density, setting different risk thresholds based on transaction amount could improve fraud detection accuracy. Higher-value transactions might need stricter anomaly detection rules compared to low-value ones.</p>
</div>
</div>
</section>
<section id="boxplot-to-detect-anomalies" class="level3">
<h3 class="anchored" data-anchor-id="boxplot-to-detect-anomalies">Boxplot to detect anomalies</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Analysis_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Fraudulent transactions exhibit a lower median transaction amount compared to non-fraudulent transactions.The presence of several outliers in fraudulent transactions suggests some high-value fraudulent activities. The spread of transaction amounts for legitimate transactions is much broader.</p>
</div>
</div>
</section>
</section>
<section id="data-preprocessing" class="level2">
<h2 class="anchored" data-anchor-id="data-preprocessing">Data Preprocessing</h2>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-7164fa6f6cfc97103f7f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7164fa6f6cfc97103f7f">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6"],[-1.3598071336738,1.19185711131486,-1.35835406159823,-0.966271711572087,-1.15823309349523,-0.425965884412454],[-0.07278117330984971,0.26615071205963,-1.34016307473609,-0.185226008082898,0.877736754848451,0.960523044882985],[2.53634673796914,0.16648011335321,1.77320934263119,1.79299333957872,1.548717846511,1.14110934232219],[1.37815522427443,0.448154078460911,0.379779593034328,-0.863291275036453,0.403033933955121,-0.168252079760302],[-0.338320769942518,0.0600176492822243,-0.503198133318193,-0.0103088796030823,-0.407193377311653,0.42098688077219],[0.462387777762292,-0.0823608088155687,1.80049938079263,1.24720316752486,0.0959214624684256,-0.0297275516639742],[0.239598554061257,-0.0788029833323113,0.791460956450422,0.23760893977178,0.592940745385545,0.476200948720027],[0.0986979012610507,0.08510165491481041,0.247675786588991,0.377435874652262,-0.270532677192282,0.260314333074874],[0.363786969611213,-0.255425128109186,-1.51465432260583,-1.38702406270197,0.8177393082352939,-0.56867137571251],[0.0907941719789316,-0.166974414004614,0.207642865216696,-0.0549519224713749,0.753074431976354,-0.371407196834471],[-0.551599533260813,1.61272666105479,0.624501459424895,-0.226487263835401,-0.822842877946363,1.34126198001957],[-0.617800855762348,1.06523531137287,0.066083685268831,0.178228225877303,0.53819555014995,0.359893837038039],[-0.991389847235408,0.48909501589608,0.7172927314108311,0.507756869957169,1.3458515932154,-0.358090652573631],[-0.311169353699879,-0.143772296441519,-0.165945922763554,-0.28792374549456,-1.11966983471731,-0.137133700217612],[1.46817697209427,0.635558093258208,2.34586494901581,-0.631418117709045,0.175121130008994,0.517616806555742],[-0.470400525259478,0.463917041022171,-2.89008319444231,-1.0596472454325,-0.451449182813529,0.401725895589603],[0.207971241929242,-0.114804663102346,1.10996937869599,-0.684092786345479,-0.237033239362776,-0.0581328233640131],[0.0257905801985591,-0.183361270123994,-0.121359313195888,1.96577500349538,-0.0381947870352842,0.06865314944254319],[0.403992960255733,-0.145783041325259,-2.26185709530414,-1.2326219700892,0.803486924960175,-0.0331937877876282],[0.251412098239705,-0.0690831352230203,0.5249797252244039,-0.208037781160366,0.408542360392758,0.08496767206820489],[-0.018306777944153,-0.225775248033138,0.247998153469754,-0.108300452035545,-0.009430697132329189,-0.208253514656728],[0.277837575558899,-0.638671952771851,0.7716794019172289,0.00527359678253453,0.79827849458971,-0.559824796253248],[-0.110473910188767,0.101288021253234,0.909412262347719,-0.190320518742841,-0.137458079619063,-0.0263976679795373],[0.06692807491467311,-0.339846475529127,-0.689280956490685,-1.17557533186321,0.141266983824769,-0.371426583174346],[0.128539358273528,0.167170404418143,-0.327641833735251,0.647376034602038,-0.206009587619756,-0.232793816737034],[-0.189114843888824,0.125894532368176,-0.139096571514147,-0.221928844458407,0.502292224181569,0.105914779097957],[0.133558376740387,-0.00898309914322813,-0.0553527940384261,0.0627228487293033,0.219422229513348,0.253844224739337],[-0.0210530534538215,0.0147241691924927,-0.0597518405929204,0.0614576285006353,0.215153147499206,0.08108025692294429],[0.005823793086804955,0.0001047052760560442,0.01473892187040212,0.004807100963911322,0.00272428337217938,0.0001428506926117777],[0,0,0,0,0,0],["Very High","Low","Very High","Very High","High","Low"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>V1<\/th>\n      <th>V2<\/th>\n      <th>V3<\/th>\n      <th>V4<\/th>\n      <th>V5<\/th>\n      <th>V6<\/th>\n      <th>V7<\/th>\n      <th>V8<\/th>\n      <th>V9<\/th>\n      <th>V10<\/th>\n      <th>V11<\/th>\n      <th>V12<\/th>\n      <th>V13<\/th>\n      <th>V14<\/th>\n      <th>V15<\/th>\n      <th>V16<\/th>\n      <th>V17<\/th>\n      <th>V18<\/th>\n      <th>V19<\/th>\n      <th>V20<\/th>\n      <th>V21<\/th>\n      <th>V22<\/th>\n      <th>V23<\/th>\n      <th>V24<\/th>\n      <th>V25<\/th>\n      <th>V26<\/th>\n      <th>V27<\/th>\n      <th>V28<\/th>\n      <th>Amount<\/th>\n      <th>Class<\/th>\n      <th>Amount_Category<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<ol type="1">
<li><p>We first normalise the amount then remove <code>Time</code> column.</p></li>
<li><p>In this analysis, the ROSE (Random Over-Sampling Examples) method was applied to generate a more balanced training set. Practical Implications for Fraud Detection:</p></li>
<li><p>In real-world applications, fraud detection models must prioritize high recall and precision, ensuring fraudulent transactions are flagged without overwhelming users with false positives.</p></li>
</ol>
<p>Banks and financial institutions must use sophisticated models such as XGBoost or Random Forest, which can handle imbalanced data more effectively than traditional logistic regression.</p>
<p>we apply all 3 to discuss which works best for this dataset.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold; color: white !important; background-color: lightblue !important;">Var1</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: lightblue !important;">Freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; border-right: 1px solid;">0</td>
<td style="text-align: right;">114086</td>
</tr>
<tr class="even">
<td style="text-align: left; border-right: 1px solid;">1</td>
<td style="text-align: right;">113760</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
</section>
<section id="model-training" class="level1">
<h1>Model Training</h1>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> int [1:227846] 0 0 0 0 0 0 0 0 0 0 ...</code></pre>
</div>
</div>
<section id="logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression">Logistic Regression</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction     0     1
         0 56174    17
         1   680    90
                                          
               Accuracy : 0.9878          
                 95% CI : (0.9868, 0.9887)
    No Information Rate : 0.9981          
    P-Value [Acc &gt; NIR] : 1               
                                          
                  Kappa : 0.2026          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.9880          
            Specificity : 0.8411          
         Pos Pred Value : 0.9997          
         Neg Pred Value : 0.1169          
             Prevalence : 0.9981          
         Detection Rate : 0.9862          
   Detection Prevalence : 0.9865          
      Balanced Accuracy : 0.9146          
                                          
       'Positive' Class : 0               
                                          </code></pre>
</div>
</div>
<section id="logistic-regression-precision-recall-curve" class="level3">
<h3 class="anchored" data-anchor-id="logistic-regression-precision-recall-curve">Logistic Regression Precision-Recall Curve</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Analysis_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="random-forest" class="level2">
<h2 class="anchored" data-anchor-id="random-forest">Random Forest</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction     0     1
         0 56804    19
         1    50    88
                                          
               Accuracy : 0.9988          
                 95% CI : (0.9985, 0.9991)
    No Information Rate : 0.9981          
    P-Value [Acc &gt; NIR] : 5.63e-05        
                                          
                  Kappa : 0.7178          
                                          
 Mcnemar's Test P-Value : 0.0003043       
                                          
            Sensitivity : 0.9991          
            Specificity : 0.8224          
         Pos Pred Value : 0.9997          
         Neg Pred Value : 0.6377          
             Prevalence : 0.9981          
         Detection Rate : 0.9972          
   Detection Prevalence : 0.9976          
      Balanced Accuracy : 0.9108          
                                          
       'Positive' Class : 0               
                                          </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Analysis_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="xgboost" class="level2">
<h2 class="anchored" data-anchor-id="xgboost">XGBoost</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
     0      1 
114086 113760 </code></pre>
</div>
</div>
<section id="model-training-and-evaluation" class="level3">
<h3 class="anchored" data-anchor-id="model-training-and-evaluation">Model Training and Evaluation</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction     0     1
         0 56822    20
         1    32    87
                                          
               Accuracy : 0.9991          
                 95% CI : (0.9988, 0.9993)
    No Information Rate : 0.9981          
    P-Value [Acc &gt; NIR] : 2.643e-09       
                                          
                  Kappa : 0.7695          
                                          
 Mcnemar's Test P-Value : 0.1272          
                                          
            Sensitivity : 0.9994          
            Specificity : 0.8131          
         Pos Pred Value : 0.9996          
         Neg Pred Value : 0.7311          
             Prevalence : 0.9981          
         Detection Rate : 0.9976          
   Detection Prevalence : 0.9979          
      Balanced Accuracy : 0.9063          
                                          
       'Positive' Class : 0               
                                          </code></pre>
</div>
</div>
</section>
<section id="area-under-the-precision-recall-curve" class="level3">
<h3 class="anchored" data-anchor-id="area-under-the-precision-recall-curve">Area Under the Precision-Recall Curve</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Analysis_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="discussion-of-results" class="level1">
<h1>Discussion of Results</h1>
<ul>
<li>Logistic Regression performs moderately well but struggles with imbalanced data.</li>
<li>Random Forest improves performance by capturing complex interactions.</li>
<li>XGBoost delivers the highest precision-recall score, making it the most effective for fraud detection.</li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>